/*
 * A speed-improved simplex noise algorithm for 2D, 3D and 4D in JavaScript.
 *
 * Based on example code by Stefan Gustavson (stegu@itn.liu.se).
 * Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).
 * Better rank ordering method by Stefan Gustavson in 2012.
 *
 * This code was placed in the public domain by its original author,
 * Stefan Gustavson. You may use it as you see fit, but
 * attribution is appreciated.
 */
function FastSimplexNoise(t){t||(t={}),this.amplitude=t.amplitude||1,this.frequency=t.frequency||1,this.octaves=parseInt(t.octaves||1),this.persistence=t.persistence||.5,this.random=t.random||Math.random
for(var e=new Uint8Array(256),i=0;256>i;i++)e[i]=i
for(var s,o,i=255;i>0;i--)s=Math.floor((i+1)*this.random()),o=e[i],e[i]=e[s],e[s]=o
this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512)
for(var i=0;512>i;i++)this.perm[i]=e[255&i],this.permMod12[i]=this.perm[i]%12}FastSimplexNoise.GRADIENTS_3D=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,-1],[0,1,-1],[0,-1,-1]],FastSimplexNoise.GRADIENTS_4D=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],FastSimplexNoise.G2=(3-Math.sqrt(3))/6,FastSimplexNoise.G3=1/6,FastSimplexNoise.G4=(5-Math.sqrt(5))/20,FastSimplexNoise.dot2D=function(t,e,i){return t[0]*e+t[1]*i},FastSimplexNoise.dot3D=function(t,e,i,s){return t[0]*e+t[1]*i+t[2]*s},FastSimplexNoise.dot4D=function(t,e,i,s,o){return t[0]*e+t[1]*i+t[2]*s+t[3]*o},FastSimplexNoise.prototype.get2DNoise=function(t,e){for(var i=this.amplitude,s=this.frequency,o=0,a=0,r=this.persistence,n=0;n<this.octaves;n++)a+=this.getRaw2DNoise(t*s,e*s)*i,o+=i,i*=r,s*=2
return a/o},FastSimplexNoise.prototype.get3DNoise=function(t,e,i){for(var s=this.amplitude,o=this.frequency,a=0,r=0,n=this.persistence,p=0;p<this.octaves;p++)r+=this.getRaw3DNoise(t*o,e*o,i*o)*s,a+=s,s*=n,o*=2
return r/a},FastSimplexNoise.prototype.get4DNoise=function(t,e,i,s){for(var o=this.amplitude,a=this.frequency,r=0,n=0,p=this.persistence,h=0;h<this.octaves;h++)n+=this.getRaw4DNoise(t*a,e*a,i*a,s*a)*o,r+=o,o*=p,a*=2
return n/r},FastSimplexNoise.prototype.getCylindricalNoise=function(t,e,i){var s=e/t,o=t/(2*Math.PI),a=2*s*Math.PI,r=o*Math.sin(a),n=o*Math.cos(a)
return this.get3DNoise(r,n,i)},FastSimplexNoise.prototype.getCylindricalTimeNoise=function(t,e,i,s){var o=e/t,a=t/(2*Math.PI),r=2*o*Math.PI,n=a*Math.sin(r),p=a*Math.cos(r)
return this.get4DNoise(n,p,i,s)},FastSimplexNoise.prototype.getRaw2DNoise=function(t,e){var i,s,o,a,r,n=FastSimplexNoise.G2,p=FastSimplexNoise.dot2D,h=FastSimplexNoise.GRADIENTS_3D,m=this.perm,l=this.permMod12,N=.5*(t+e)*(Math.sqrt(3)-1),f=Math.floor(t+N),u=Math.floor(e+N),M=(f+u)*n,c=f-M,S=u-M,x=t-c,d=e-S
x>d?(a=1,r=0):(a=0,r=1)
var F=x-a+n,v=d-r+n,D=x-1+2*n,y=d-1+2*n,I=255&f,g=255&u,P=l[I+m[g]],G=l[I+a+m[g+r]],R=l[I+1+m[g+1]],q=.5-x*x-d*d
0>q?i=0:(q*=q,i=q*q*p(h[P],x,d))
var w=.5-F*F-v*v
0>w?s=0:(w*=w,s=w*w*p(h[G],F,v))
var A=.5-D*D-y*y
return 0>A?o=0:(A*=A,o=A*A*p(h[R],D,y)),70.1*(i+s+o)},FastSimplexNoise.prototype.getRaw3DNoise=function(t,e,i){var s,o,a,r,n,p,h,m,l,N,f=FastSimplexNoise.dot3D,u=FastSimplexNoise.GRADIENTS_3D,M=FastSimplexNoise.G3,c=this.perm,S=this.permMod12,x=(t+e+i)/3,d=Math.floor(t+x),F=Math.floor(e+x),v=Math.floor(i+x),D=(d+F+v)*M,y=d-D,I=F-D,g=v-D,P=t-y,G=e-I,R=i-g
P>=G?G>=R?(n=1,p=0,h=0,m=1,l=1,N=0):P>=R?(n=1,p=0,h=0,m=1,l=0,N=1):(n=0,p=0,h=1,m=1,l=0,N=1):R>G?(n=0,p=0,h=1,m=0,l=1,N=1):R>P?(n=0,p=1,h=0,m=0,l=1,N=1):(n=0,p=1,h=0,m=1,l=1,N=0)
var q=P-n+M,w=G-p+M,A=R-h+M,T=P-m+2*M,E=G-l+2*M,_=R-N+2*M,U=P-1+3*M,C=G-1+3*M,b=R-1+3*M,j=255&d,k=255&F,z=255&v,B=S[j+c[k+c[z]]],H=S[j+n+c[k+p+c[z+h]]],J=S[j+m+c[k+l+c[z+N]]],K=S[j+1+c[k+1+c[z+1]]],L=.5-P*P-G*G-R*R
0>L?s=0:(L*=L,s=L*L*f(u[B],P,G,R))
var O=.5-q*q-w*w-A*A
0>O?o=0:(O*=O,o=O*O*f(u[H],q,w,A))
var Q=.5-T*T-E*E-_*_
0>Q?a=0:(Q*=Q,a=Q*Q*f(u[J],T,E,_))
var V=.5-U*U-C*C-b*b
return 0>V?r=0:(V*=V,r=V*V*f(u[K],U,C,b)),94.6*(s+o+a+r)},FastSimplexNoise.prototype.getRaw4DNoise=function(t,e,i,s){var o,a,r,n,p,h=FastSimplexNoise.dot4D,m=FastSimplexNoise.GRADIENTS_4D,l=FastSimplexNoise.G4,N=this.perm,f=(this.permMod12,(t+e+i+s)*(Math.sqrt(5)-1)/4),u=Math.floor(t+f),M=Math.floor(e+f),c=Math.floor(i+f),S=Math.floor(s+f),x=(u+M+c+S)*l,d=u-x,F=M-x,v=c-x,D=S-x,y=t-d,I=e-F,g=i-v,P=s-D,G=0,R=0,q=0,w=0
y>I?G++:R++,y>g?G++:q++,y>P?G++:w++,I>g?R++:q++,I>P?R++:w++,g>P?q++:w++
var A,T,E,_,U,C,b,j,k,z,B,H
A=G>=3?1:0,T=R>=3?1:0,E=q>=3?1:0,_=w>=3?1:0,U=G>=2?1:0,C=R>=2?1:0,b=q>=2?1:0,j=w>=2?1:0,k=G>=1?1:0,z=R>=1?1:0,B=q>=1?1:0,H=w>=1?1:0
var J=y-A+l,K=I-T+l,L=g-E+l,O=P-_+l,Q=y-U+2*l,V=I-C+2*l,W=g-b+2*l,X=P-j+2*l,Y=y-k+3*l,Z=I-z+3*l,$=g-B+3*l,te=P-H+3*l,ee=y-1+4*l,ie=I-1+4*l,se=g-1+4*l,oe=P-1+4*l,ae=255&u,re=255&M,ne=255&c,pe=255&S,he=N[ae+N[re+N[ne+N[pe]]]]%32,me=N[ae+A+N[re+T+N[ne+E+N[pe+_]]]]%32,le=N[ae+U+N[re+C+N[ne+b+N[pe+j]]]]%32,Ne=N[ae+k+N[re+z+N[ne+B+N[pe+H]]]]%32,fe=N[ae+1+N[re+1+N[ne+1+N[pe+1]]]]%32,ue=.5-y*y-I*I-g*g-P*P
0>ue?o=0:(ue*=ue,o=ue*ue*h(m[he],y,I,g,P))
var Me=.5-J*J-K*K-L*L-O*O
0>Me?a=0:(Me*=Me,a=Me*Me*h(m[me],J,K,L,O))
var ce=.5-Q*Q-V*V-W*W-X*X
0>ce?r=0:(ce*=ce,r=ce*ce*h(m[le],Q,V,W,X))
var Se=.5-Y*Y-Z*Z-$*$-te*te
0>Se?n=0:(Se*=Se,n=Se*Se*h(m[Ne],Y,Z,$,te))
var xe=.5-ee*ee-ie*ie-se*se-oe*oe
return 0>xe?p=0:(xe*=xe,p=xe*xe*h(m[fe],ee,ie,se,oe)),72.3*(o+a+r+n+p)},FastSimplexNoise.prototype.getSphericalNoise=function(t,e,i){var s=e/t,o=i/t,a=2*s*Math.PI,r=o*Math.PI,n=Math.sin(r+Math.PI),p=2*Math.PI,h=p*Math.sin(a)*n,m=p*Math.cos(a)*n,l=p*Math.cos(r)
return this.get3DNoise(h,m,l)},FastSimplexNoise.prototype.getSphericalTimeNoise=function(t,e,i,s){var o=e/t,a=i/t,r=2*o*Math.PI,n=a*Math.PI,p=Math.sin(n+Math.PI),h=2*Math.PI,m=h*Math.sin(r)*p,l=h*Math.cos(r)*p,N=h*Math.cos(n)
return this.get4DNoise(m,l,N,s)},"undefined"!=typeof define&&define.amd&&define(function(){return FastSimplexNoise}),"undefined"!=typeof exports&&(exports.FastSimplexNoise=FastSimplexNoise),"undefined"!=typeof module&&(module.exports=FastSimplexNoise)
